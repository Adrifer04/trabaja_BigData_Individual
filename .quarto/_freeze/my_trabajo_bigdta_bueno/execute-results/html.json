{
  "hash": "e1b69119d4b72125f37a8fa22579ba13",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"La primera de España\"\ndescription: |\n  ¿Cómo consiguió la selección este gran hito?\nauthor:\n  - name: Adrian Fernandez\n    affiliation: Universitat de València\n    affiliation-url: https://www.uv.es\ndate: 2026-01-07\ncategories: [trabajo BigData, Futbol, España]\nimage: \"./imagenes/BANNER.jpeg\"\ntitle-block-banner: true\ntitle-block-banner-color: \"red\"\ntoc-depth: 3\nsmooth-scroll: true\nformat:\n  html:\n    link-external-newwindow: true\n    code-tools: true\n    code-link: true\n    code-fold: true\n    theme: flatly\n---\n\n----------------------\n\n## DATOS\n\nVamos a utilizar datos de la web de `Kaggle`. La web la encontramos [aquí](https://www.kaggle.com/).\n\nLos datos contienen datos sobre futbolistas, selecciones, ubicaciones y mucho más.\n\nAquí las librerías:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(gt)\nlibrary(gtExtras)   \nlibrary(countrycode) \nlibrary(magick)\nlibrary(janitor)\nlibrary(maps)\nlibrary(plotly)\nlibrary(ggimage)\nlibrary(cropcircles)\n```\n:::\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nruta_a_datos_1 <- \"./datos/FIFA_World_Cup_1558_23.csv\"\ndf_completo <- read_csv(ruta_a_datos_1)\n\naño_2010 <- df_completo %>%\n  rename(Año = Year, Ciudad = City, Estadio = Stadium) %>% \n  select(Año, Estadio, Ciudad) %>% \n  filter(Año == 2010) %>%\n  group_by(Ciudad, Estadio) %>% \n  mutate(Ciudad = case_when( \n    Ciudad ==\"Mangaung/Bloemfontein\" ~ \"Bloemfontein\",\n    Ciudad == \"Nelson Mandela Bay/Port Elizabeth\" ~ \"Port Elizabeth\",\n    Ciudad == \"Polokwane\" ~ \"Pietersburg\", \n    Ciudad == \"Tshwane/Pretoria\" ~ \"Pretoria\", \n    Ciudad == \"Phokeng\" ~ \"Rustenburg\",\n    TRUE ~ Ciudad)) %>% \n  slice(1) %>%\n  ungroup()\n\ndata(world.cities)\ncoords_sudafrica <- world.cities %>%\n  filter(country.etc == \"South Africa\") %>%\n  select(name, lat, long)\n\nmapa_finales <- año_2010 %>% \n  left_join(coords_sudafrica, by = c(\"Ciudad\" = \"name\")) \n\nmap_plot <- plot_geo(data = mapa_finales,\n                     lat = ~lat,   \n                     lon = ~long,\n                     height = 600) %>% \n  add_markers(\n    text = ~paste(\"<b>Ciudad:</b>\", Ciudad, \"<br>\",\n                  \"<b>Estadio:</b>\", Estadio),\n    color = I(\"#D32F2F\"), \n    size = I(12),    \n    marker = list(\n      line = list(color = \"white\", width = 0.5),\n      hoverinfo = \"text\")) %>% \n  layout(\n    title = \"Sedes Mundial Sudáfrica 2010\",\n    geo = list(\n      scope = 'africa',    \n      showframe = FALSE,\n      showland = TRUE,\n      landcolor = \"#F0F0F0\",\n      showocean = TRUE,\n      oceancolor = \"#B3E5FC\",\n      countrycolor = \"white\",\n      lonaxis = list(range = c(16, 33)), \n      lataxis = list(range = c(-35, -22))\n    )\n  ) %>%\n  config(displayModeBar = FALSE)\n\nmap_plot\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-249d55ab40eab6720d71\" style=\"width:95%;height:600px;\" class=\"plotly html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-249d55ab40eab6720d71\">{\"x\":{\"visdat\":{\"76702fdb77b4\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"76702fdb77b4\",\"attrs\":{\"76702fdb77b4\":{\"lat\":{},\"lon\":{},\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"x\":{},\"y\":{},\"type\":\"scatter\",\"mode\":\"markers\",\"text\":{},\"color\":[\"#D32F2F\"],\"size\":[12],\"marker\":{\"line\":{\"color\":\"white\",\"width\":0.5},\"hoverinfo\":\"text\"},\"inherit\":true}},\"layout\":{\"height\":600,\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"mapType\":\"geo\",\"title\":\"Sedes Mundial Sudáfrica 2010\",\"geo\":{\"domain\":{\"x\":[0,1],\"y\":[0,1]},\"scope\":\"africa\",\"showframe\":false,\"showland\":true,\"landcolor\":\"#F0F0F0\",\"showocean\":true,\"oceancolor\":\"#B3E5FC\",\"countrycolor\":\"white\",\"lonaxis\":{\"range\":[16,33]},\"lataxis\":{\"range\":[-35,-22]}},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false,\"displayModeBar\":false},\"data\":[{\"lat\":[-29.149999999999999,-33.93,-29.870000000000001,-26.190000000000001,-26.190000000000001,-25.469999999999999,-23.890000000000001,-33.960000000000001,-25.73,-25.649999999999999],\"lon\":[26.23,18.460000000000001,30.989999999999998,28.039999999999999,28.039999999999999,30.98,29.449999999999999,25.59,28.219999999999999,27.239999999999998],\"type\":\"scattergeo\",\"mode\":\"markers\",\"text\":[\"<b>Ciudad:<\\/b> Bloemfontein <br> <b>Estadio:<\\/b> Free State Stadium\",\"<b>Ciudad:<\\/b> Cape Town <br> <b>Estadio:<\\/b> Cape Town Stadium\",\"<b>Ciudad:<\\/b> Durban <br> <b>Estadio:<\\/b> Durban Stadium\",\"<b>Ciudad:<\\/b> Johannesburg <br> <b>Estadio:<\\/b> Ellis Park Stadium\",\"<b>Ciudad:<\\/b> Johannesburg <br> <b>Estadio:<\\/b> Soccer City Stadium\",\"<b>Ciudad:<\\/b> Nelspruit <br> <b>Estadio:<\\/b> Mbombela Stadium\",\"<b>Ciudad:<\\/b> Pietersburg <br> <b>Estadio:<\\/b> Peter Mokaba Stadium\",\"<b>Ciudad:<\\/b> Port Elizabeth <br> <b>Estadio:<\\/b> Port Elizabeth Stadium\",\"<b>Ciudad:<\\/b> Pretoria <br> <b>Estadio:<\\/b> Loftus Versfeld Stadium\",\"<b>Ciudad:<\\/b> Rustenburg <br> <b>Estadio:<\\/b> Royal Bafokeng Sports Palace\"],\"marker\":{\"color\":\"rgba(211,47,47,1)\",\"size\":[12,12,12,12,12,12,12,12,12,12],\"sizemode\":\"area\",\"line\":{\"color\":\"white\",\"width\":0.5},\"hoverinfo\":\"text\"},\"textfont\":{\"color\":\"rgba(211,47,47,1)\",\"size\":12},\"line\":{\"color\":\"rgba(211,47,47,1)\",\"width\":12},\"geo\":\"geo\",\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n#| message: false\n#| warning: false\n\nruta_a_datos_2 <- \"./datos/resultados.csv\"\ndf_completo <- read_csv(ruta_a_datos_2) \n\nPartidos_España <- df_completo %>% \n  mutate(date = as.Date(date)) %>% \n  filter(tournament == \"FIFA World Cup\",\n         between(date, as.Date(\"2010-06-11\"), as.Date(\"2010-07-11\"))) %>% \n  filter(home_team == \"Spain\" | away_team == \"Spain\") %>%\n  \n  mutate(Resultado_ESP = case_when(\n    (home_team == \"Spain\" & home_score < away_score) ~ \"Perdido\",\n    (away_team == \"Spain\" & away_score < home_score) ~ \"Perdido\",\n    (home_team == \"Spain\" & home_score > away_score) ~ \"Ganado\",\n    (away_team == \"Spain\" & away_score > home_score) ~ \"Ganado\" ))%>% \n  \n  unite(col = \"Resultado\", \n        home_score, away_score, \n        sep = \" - \", \n        remove = FALSE) %>% \n \n  rename(Local = home_team, Visitante = away_team,\n         Torneo = tournament) %>% \n  select(Local, Visitante, Resultado, Resultado_ESP)\n\nPartidos_España <- Partidos_España %>%\n  mutate(Orden = 1:n(),\n         Fase = c(\"Grupos 1\", \"Grupos 2\", \"Grupos 3\", \n                  \"Octavos\", \"Cuartos\", \"Semis\", \"Final\"),\n         Rival = ifelse(Local == \"Spain\", Visitante, Local))\n\nggplot(Partidos_España, aes(x = Orden, y = Resultado_ESP, group = 1)) +\n  geom_path(color = \"gray80\", size = 1) +\n  geom_point(aes(color = Resultado_ESP), size = 12) + \n  geom_text(aes(label = Resultado), color = \"white\", fontface = \"bold\", size = 3) +\n  geom_text(aes(label = paste(\"vs\", Rival)), vjust = -2.5, size = 3.5, fontface = \"italic\") +\n  geom_text(aes(label = Fase), vjust = 3.5, size = 3, color = \"gray30\") +\n  \n  # Colores y escalas\n  scale_color_manual(values = c(\"Ganado\" = \"#228B22\", \"Perdido\" = \"#CC0000\")) +\n  scale_y_discrete(limits = c(\"Perdido\", \"Ganado\")) +\n  \n  # Limpieza visual\n  theme_minimal() +\n  labs(title = \"Cronología: El camino a la estrella\",\n       subtitle = \"Resultados oficiales de cada encuentro\",\n       x = NULL, y = NULL) +\n  theme(\n    panel.grid = element_blank(),\n    axis.text = element_blank(),\n    legend.position = \"none\",\n    plot.title = element_text(face = \"bold\", size = 14)\n  )\n\n#| message: false\n#| warning: false\n\nruta_a_datos_3 <- \"./datos/goalscorers.csv\"\ndf_completo <- read_csv(ruta_a_datos_3)\n\nmundial <- df_completo %>% \n  rename(Fecha = date, Equipo_Local = home_team, Equipo_Visitante = away_team\n         , Goleador = scorer) %>% \n  select(Fecha, Equipo_Local, Equipo_Visitante, Goleador) %>% \n  mutate(Fecha = as.Date(Fecha)) %>% \n  filter(between(Fecha, as.Date(\"2010-06-11\") , as.Date(\"2010-07-11\"))) %>% \n  filter(Equipo_Local == \"Spain\"| Equipo_Visitante == \"Spain\") %>% \n  count(Goleador) %>% \n  arrange(desc(n)) %>% \n  head(3)\n\nimagenes_goleadores <- data.frame(\n  Goleador = c(\"David Villa\", \"Andrés Iniesta\", \"Carles Puyol\"),\n  Foto = c(\"villa.jpg\", \"iniesta.png\", \"puyol.jpg\")) %>% \n  mutate(logo = file.path(\"imagenes\", Foto))\n\ntop_3 <- left_join(mundial,imagenes_goleadores, by = \"Goleador\") \n\ntop_3 <- top_3 %>%\n  mutate(logo_circular = circle_crop(logo))\n\nmi_grafico <- ggplot(top_3, aes(x = reorder(Goleador, n), y = n)) +\n  geom_col(fill = \"#DD0000\", width = 0.6) +\n  coord_flip() +\n  geom_image(aes(image = logo_circular, y = 0), size = 0.3) +\n  \n  geom_text(aes(label = n), hjust = -0.2, fontface = \"bold\", size = 3.5) +\n  \n  scale_y_continuous(expand = expansion(mult = c(0.2, 0.1))) + \n  \n  labs(\n    title = \"Goleadores de la selección\",\n    subtitle = \"Mundial Sudáfrica 2010\",\n    x = NULL, \n    y = \"Goles\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_blank(),\n    axis.text.x = element_blank(),\n    axis.ticks = element_blank(),\n    panel.grid.major.y = element_blank(),\n    panel.grid = element_blank(),\n    plot.margin = margin(10, 20, 10, 20))\n\nmi_grafico\n\n#| message: false\n#| warning: false\n\nruta_a_datos_4 <- \"./datos/FIFA - 2010.csv\"\ndf_completo <- read_csv(ruta_a_datos_4)\n\ntop_10_grafico <- df_completo %>% \n  rename(equipo = Team, \n         partidos_jugados = `Games Played`, \n         goles_contra = `Goals Against`) %>% \n  mutate(equipo = case_when( equipo == \"England\" ~ \"United Kingdom\",\n                           TRUE ~ equipo)) %>%\n  mutate(Goles_partido = goles_contra / partidos_jugados) %>% \n  select(equipo, partidos_jugados, Goles_partido) %>% \n  filter(partidos_jugados >= 4) %>% \n  arrange(Goles_partido) %>% \n  mutate(iso2 = countrycode(equipo, origin = \"country.name\",\n                            destination = \"iso2c\")) %>% \n  mutate(iso2 = tolower(iso2)) %>% \n  mutate(flag_URL = paste0(\"[https://hatscripts.github.io/circle-flags/flags/](https://hatscripts.github.io/circle-flags/flags/)\", iso2, \".svg\"))\n\nmi_grafico <- ggplot(top_10_grafico, aes(x = partidos_jugados, y = Goles_partido)) +\n  theme_minimal() +\n  \n  geom_image(aes(image = flag_URL), size = 0.08, \n             position = position_jitter(width = 0.2, height = 0.02, seed = 123)) + \n  \n  labs(\n    title = \"Las mejores defensas\",\n    x = \"Partidos Jugados\",\n    y = \"Goles encajados\") +\n  scale_x_continuous(breaks = 4:7,                 \n                     limits = c(3.5, 7.5),          \n                     expand = c(0, 0)) +\n  scale_y_continuous(expand = expansion(mult = c(0.1, 0.1))) +\n  \n  theme(\n    plot.title = element_text(face = \"bold\", size = 16),\n    panel.grid = element_blank(),\n    panel.grid.minor = element_blank(),\n    plot.margin = margin(10, 20, 10, 20))\n\nmi_grafico\n\n#| message: false\n#| warning: false\n\nimg1  <- image_read(\"./imagenes/1.png\") %>% image_scale(\"700\")\nimg2  <- image_read(\"./imagenes/2.png\") %>% image_scale(\"700\")\nimg3  <- image_read(\"./imagenes/3.png\") %>% image_scale(\"700\")\nimg4  <- image_read(\"./imagenes/4.png\") %>% image_scale(\"700\")\nimg5  <- image_read(\"./imagenes/5.png\") %>% image_scale(\"700\")\nimg6  <- image_read(\"./imagenes/6.png\") %>% image_scale(\"700\")\nimg7  <- image_read(\"./imagenes/7.png\") %>% image_scale(\"700\")\nimg8  <- image_read(\"./imagenes/8.png\") %>% image_scale(\"700\")\nimg9  <- image_read(\"./imagenes/9.png\") %>% image_scale(\"700\")\nimg10 <- image_read(\"./imagenes/10.png\") %>% image_scale(\"700\")\nimg11 <- image_read(\"./imagenes/11.png\") %>% image_scale(\"700\")\nimg12 <- image_read(\"./imagenes/12.png\") %>% image_scale(\"700\")\nimg13 <- image_read(\"./imagenes/13.png\") %>% image_scale(\"700\")\nimg14 <- image_read(\"./imagenes/14.png\") %>% image_scale(\"700\")\nimg15 <- image_read(\"./imagenes/15.png\") %>% image_scale(\"700\")\n\nequipos_unidos <- image_join(img1, img2, img3, img4, img5, img6, img7, img8, \n                             img9, img10, img11, img12, img13, img14, img15)\n\nanimacion <- image_animate(equipos_unidos, fps = 2)\n\nprint(animacion)\n\n#| message: false\n#| warning: false\n\nruta_a_datos_5 <- \"./datos/WorldCups.csv\"\ndf_completo <- read_csv(ruta_a_datos_5)\n\ntabla_preparada <- df_completo %>%\n  filter(Year <= 2010) %>% \n  rename(ganador = Winner) %>%\n  mutate(ganador = case_when( \n    ganador == \"Germany FR\" ~ \"Germany\",\n    ganador == \"England\" ~ \"United Kingdom\",\n    TRUE ~ ganador)) %>% \n  group_by(ganador) %>% \n  summarise(n = n()) %>% \n  arrange(desc(n)) %>% \n  mutate(iso2 = countrycode(ganador, origin = \"country.name\",\n                            destination = \"iso2c\")) %>%\n  mutate(iso2 = tolower(iso2)) %>%\n  mutate(bandera_url = paste0(\"[https://hatscripts.github.io/circle-flags/flags/](https://hatscripts.github.io/circle-flags/flags/)\", iso2, \".svg\")) %>%\n  select(bandera_url, ganador, n)\n\nmi_tabla_final <- tabla_preparada %>%\n  gt() %>%\n  gt_img_rows(columns = bandera_url, height = 30) %>%\n  cols_label(\n    bandera_url = \"\",\n    ganador = \"Selección\",\n    n = \"Títulos\") %>%\n  tab_header(\n    title = md(\"**Palmarés**\"),\n    subtitle = \"Mundiales ganados hasta 2010\")%>%\n  cols_align(align = \"center\", columns = n) %>%\n  gt_theme_dark() %>%\n  tab_style(\n    style = list(cell_text(weight = \"bold\", color = \"#FFD700\", size = pct(100))),\n    locations = cells_body(columns = n))\n\nmi_tabla_final\n\n#| echo: false\nsessioninfo::session_info()\n",
    "supporting": [
      "my_trabajo_bigdta_bueno_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"site_libs/plotly-binding-4.11.0/plotly.js\"></script>\n<script src=\"site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.2/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.2/js/crosstalk.min.js\"></script>\n<link href=\"site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}